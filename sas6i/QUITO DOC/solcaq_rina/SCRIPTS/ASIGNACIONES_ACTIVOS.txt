DECLARE 
CURSOR ASIGNACIONES IS
   SELECT DPR_ARA_CODIGO,DPR_CODIGO,PRS_CODIGO,NOMBRE
   FROM CORRESPONDENCIA_AREA_DEP
   ORDER BY 1,2;
I NUMBER:=1;
CURSOR ACTIVOS(P_NOMBRE VARCHAR2) IS 
SELECT SBGACTFJO_GRPACTFJO_EMP_CODIGO EMPRESA,
ACTFSBGACTFJO_GRPACTFJO_CODIGO GRUPO,
ACTFJOGNR_SBGACTFJO_CODIGO     SUBGRUPO,
ACTFJOGNR_CODIGO               ACTIVO, 
CODIGO,
VALOR_INICIAL
FROM ACTIVOS_FIJOS_ESPECIFICOS
WHERE UBICACION = PNOMBRE
ORDER BY 1,2,3,4;
BEGIN 
    FOR RASIGNACIONES IN ASIGNACIONES LOOP
    BEGIN   
       INSERT INTO ASIGNACIONES_REINGRESOS_ACTIVO
       VALUES('CSI','A',I,RASIGNACIONES.PRS_CODIGO,
              RASIGNACIONES.DPR_ARA_CODIGO,RASIGNACIONES.DPR_CODIGO,
              'AD00',TO_DATE('01/07/2006','DD/MM/YYYY'),'N',
              'MIGRACION DE DATOS DEL SAFI AL NUEVO SISTEMA, JULIO/2006',NULL,NULL)
       FOR RACTIVOS IN ACTIVOS(RASIGNACIONES.NOMBRE) LOOP
          INSERT INTO DETALLES_ASINGACIONES_REINGRES
          VALUES('CSI','A',I,ASGRNG_SEQ.NEXTVAL,'CSI',RACTIVOS.GRUPO,RACTIVOS.SUBGRUPO,
          RACTIVOS.ACTIVO,RACTIVOS.CODIGO,RACTIVOS.VALOR_INICIAL,'N',TO_DATE('01/07/2006','DD/MM/YYYY'));
          UPDATE ACTIVOS_FIJOS_ESPECIFICOS
          SET ESTADO_DE_ASIGNACION = 'V',
              NUMERO_ASIGNACION = I
          WHERE SBGACTFJO_GRPACTFJO_EMP_CODIGO = 'CSI' AND
              ACTFSBGACTFJO_GRPACTFJO_CODIGO = RACTIVOS.GRUPO AND
              ACTFJOGNR_SBGACTFJO_CODIGO     = RACTIVOS.SUBGRUPO AND
              ACTFJOGNR_CODIGO               = RACTIVOS.ACTIVO AND
              CODIGO                         = RACTIVOS.CODIGO;
       BEGIN
       EXCEPTION
       WHEN OTHERS THEN 
           DBMS_OUTPUT.PUT_LINE('No se pudo insertar los activos en la ubicacion '||ractivo.nombre);
       END;
       END LOOP; 
    EXCEPTION WHEN OTHERS THEN
       DBMS_OUTPUT.PUT_LINE('No se pudo insertar los activos en la ubicacion '||ractivo.nombre);
    END;
    I:= I+1;
    END LOOP;
END;                         
