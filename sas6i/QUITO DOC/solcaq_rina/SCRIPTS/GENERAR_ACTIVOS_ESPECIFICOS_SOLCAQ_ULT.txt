DECLARE
I NUMBER;
J NUMBER :=0;
CODIGO VARCHAR2(25);
CODIGO_IND VARCHAR2(25);  
CURSOR ACTIVOS IS
      SELECT * FROM ACTIVOS_FIJOS_GENERALES
      ORDER BY SBGACTFJO_GRPACTFJO_EMP_CODIGO,
SBGACTFJO_GRPACTFJO_CODIGO,     
SBGACTFJO_CODIGO,
DESCRIPCION,                    
FECHA_INGRESO                  ,
CANTIDAD_INICIAL              , 
VALOR_INICIAL                  ,
VALOR_ACTUAL                   ,
MARCA  ,                       
MODELO,
VIDA_UTIL                      ,                         
PORCENTAJE_DEPRECIACION        ;
CURSOR ACDET (S_GRPACTFJO_EMP_CODIGO varchar2,           
       S_GRPACTFJO_CODIGO NUMBER,               
       s_CODIGO NUMBER,
       M_DESCRIPCION VARCHAR2,            
       M_FECHA_INGRESO DATE,          
       M_VALOR_INICIAL NUMBER,          
       M_VALOR_ACTUAL NUMBER,          
       M_MARCA        VARCHAR2,          
       M_MODELO       VARCHAR2,                    
       M_VIDA_UTIL    NUMBER,          
       M_PORCENTAJE_DEPRECIACION NUMBER,
       M_OBSERVACIONES VARCHAR2) IS 
SELECT S.GRPACTFJO_EMP_CODIGO,           
       S.GRPACTFJO_CODIGO GRUPO,               
       S.CODIGO SUBGRUPO,
       M.DESCRIPCION,            
       M.FECHA_INGRESO,          
       M.VALOR_INICIAL,          
       M.VALOR_ACTUAL ,          
       M.MARCA        ,          
       M.MODELO       ,                    
       M.VIDA_UTIL    ,          
       M.PORCENTAJE_DEPRECIACION,
       M.OBSERVACIONES,M.NUMERO_SERIE,M.CODIGO_PROPIO,M.UBICACION
FROM ACTIVOS_FIJOS_MAESTRO M,SUBGRUPOS_ACTIVOS_FIJOS S
WHERE  S.GRPACTFJO_EMP_CODIGO = S_GRPACTFJO_EMP_CODIGO AND           
       S.GRPACTFJO_CODIGO = S_GRPACTFJO_CODIGO AND               
       S.CODIGO = s_CODIGO AND
       M.DESCRIPCION = M_DESCRIPCION AND            
       M.FECHA_INGRESO = TO_CHAR(M_FECHA_INGRESO,'DD/MM/YYYY') AND          
       M.VALOR_INICIAL = M_VALOR_INICIAL AND         
       M.VALOR_ACTUAL = M_VALOR_ACTUAL AND          
       NVL(M.MARCA,'NO EXISTE') = NVL(M_MARCA,'NO EXISTE') AND          
       NVL(M.MODELO,'NO EXISTE')= NVL(M_MODELO,'NO EXISTE') AND
       M.VIDA_UTIL    = M_VIDA_UTIL AND
       M.PORCENTAJE_DEPRECIACION = M_PORCENTAJE_DEPRECIACION AND
       M.OBSERVACIONES = M_OBSERVACIONES
ORDER BY 1,2,3,5,6,7,8,9,10,11,12,3,14,15;
BEGIN
   FOR RACTIVOS IN ACTIVOS LOOP
      CODIGO:=TO_CHAR(RACTIVOS.SBGACTFJO_GRPACTFJO_CODIGO,'FM0009')||'.'||TO_CHAR(RACTIVOS.SBGACTFJO_CODIGO,'FM0009')||'.'||TO_CHAR(RACTIVOS.CODIGO,'FM0009');
      I:=1;
      FOR RACTDET IN ACDET('CSI',RACTIVOS.SBGACTFJO_GRPACTFJO_CODIGO,     
                            RACTIVOS.SBGACTFJO_CODIGO,RACTIVOS.DESCRIPCION,RACTIVOS.FECHA_INGRESO,                  
                            RACTIVOS.VALOR_INICIAL,RACTIVOS.VALOR_ACTUAL,
                            RACTIVOS.MARCA,RACTIVOS.MODELO,RACTIVOS.VIDA_UTIL,RACTIVOS.PORCENTAJE_DEPRECIACION,        
                            RACTIVOS.OBSERVACIONES) LOOP
      BEGIN
         CODIGO_IND:=TO_CHAR(RACTIVOS.SBGACTFJO_GRPACTFJO_CODIGO,'FM0009')||'.'||TO_CHAR(RACTIVOS.SBGACTFJO_CODIGO,'FM0009')||'.'||TO_CHAR(RACTIVOS.CODIGO,'FM0009')||'.'||TO_CHAR(I,'FM0009');
         INSERT INTO ACTIVOS_FIJOS_ESPECIFICOS (SBGACTFJO_GRPACTFJO_EMP_CODIGO,
                   ACTFSBGACTFJO_GRPACTFJO_CODIGO,ACTFJOGNR_SBGACTFJO_CODIGO,ACTFJOGNR_CODIGO,CODIGO,DESCRIPCION,
                   PRVACTFJO_EMP_CODIGO,PRVACTFJO_CODIGO,INGACTFJO_EMP_CODIGO,INGACTFJO_NUMERO,
                   FECHA_INGRESO,FECHA_BAJA,TIPO,VALOR_INICIAL,VALOR_ACTUAL,                   
                   IVA,MARCA,MODELO,NUMERO_SERIE,VIDA_UTIL,PORCENTAJE_DEPRECIACION,        
                   PORCENTAJE_REVALORIZACION,ESTADO,ESTADO_DE_DISPONIBILIDAD,ESTADO_DE_ASIGNACION,           
                   OBSERVACIONES,CONTABILIZADO,CODIGO_PROPIO,NUMERO_ASIGNACION,UBICACION)              
         VALUES('CSI',
                RACTIVOS.SBGACTFJO_GRPACTFJO_CODIGO,RACTIVOS.SBGACTFJO_CODIGO,RACTIVOS.CODIGO,I,RACTIVOS.DESCRIPCION,
                   NULL,NULL,NULL,NULL,
                   RACTIVOS.FECHA_INGRESO,NULL,RACTIVOS.TIPO,RACTIVOS.VALOR_INICIAL,RACTIVOS.VALOR_ACTUAL,
                   RACTIVOS.IVA,RACTIVOS.MARCA,RACTIVOS.MODELO,RACTDET.NUMERO_SERIE,RACTIVOS.VIDA_UTIL,RACTIVOS.PORCENTAJE_DEPRECIACION,
                   RACTIVOS.PORCENTAJE_REVALORIZACION,'B',RACTIVOS.ESTADO_DE_DISPONIBILIDAD,'F',
                   RACTIVOS.OBSERVACIONES,'V',RACTDET.CODIGO_PROPIO,NULL,RACTDET.UBICACION);
      EXCEPTION
      WHEN OTHERS THEN
         NULL;
--         DBMS_OUTPUT.PUT_LINE('Se dio un error al insertar el item '|| CODIGO_IND ||' '||SUBSTR(RACTDET.DESCRIPCION,1,80)||' '||SQLERRM);
      END;
         I:=I+1;         
         J:=J+1;
      END LOOP; 
      IF I-1 <> RACTIVOS.CANTIDAD_INICIAL THEN
         DBMS_OUTPUT.PUT_LINE('No coincide la cantidad con el numero de items ingresados '||CODIGO||
                              ' El valor de i es: '||to_char(i) || ' La cantidad es '||
                              to_char(ractivos.cantidad_inicial));
      END IF;     
   END LOOP;
   DBMS_OUTPUT.PUT_LINE('Se insertaron tantos activos :'||to_char(j));
END;
/
