/* Devuelve devuelve el porcentaje del grado del cargo para calcular la responsabilidad */
FUNCTION CALCULA_RESPONSABILIDAD
 (CEMPRESA IN EMPRESAS.CODIGO%TYPE
 ,NEMPLEADO IN EMPLEADOS_ROLES.CODIGO%TYPE
 ,NNUMROL IN ROLES_DE_PAGOS.NUMERO%TYPE
 )
 RETURN NUMBER;
PRAGMA RESTRICT_REFERENCES (CALCULA_RESPONSABILIDAD, WNDS);


/* Devuelve el porcentaje del sueldo para el calculo del subsidio por responasabilidad */
FUNCTION CALCULA_RESPONSABILIDAD
 (CEMPRESA IN EMPRESAS.CODIGO%TYPE
 ,NEMPLEADO IN EMPLEADOS_ROLES.CODIGO%TYPE
 ,NNUMROL IN ROLES_DE_PAGOS.NUMERO%TYPE
 )
 RETURN NUMBER
 IS

VDATO NUMBER := 0;
VPORCENTAJE NUMBER := 0;
BEGIN
--Es una función especial para el Rol de Pagos  de Solca Quito, que devuelve
--el porcentaje del sueldo dependiendo del grado del cargo del empleado.   
   SELECT NVL(GRADO,0) INTO VDATO
   FROM EMPLEADOS_ROLES E,CARGOS_EMPLEADOS C
   WHERE  E.EMP_CODIGO = CEMPRESA AND
          E.CODIGO = NEMPLEADO AND
          C.EMP_CODIGO = CEMPRESA AND
          E.CRGEMP_EMP_CODIGO = C.EMP_CODIGO AND
          E.CRGEMP_CODIGO = C.CODIGO;
   IF VDATO > 0 THEN
      SELECT NVL(TO_NUMBER(RV_ABBREVIATION)/100,0) INTO VPORCENTAJE
      FROM CG_REF_CODES
      WHERE RV_DOMAIN = 'GRADO_CARGO' AND
            RV_LOW_VALUE = VDATO;
   ELSE 
      VPORCENTAJE := 0;
   END IF;            
   RETURN VPORCENTAJE;
EXCEPTION
WHEN OTHERS THEN
    RAISE_APPLICATION_ERROR(-20110,'CALCULA_RESPONSABILIDAD'||SQLERRM);
END;
