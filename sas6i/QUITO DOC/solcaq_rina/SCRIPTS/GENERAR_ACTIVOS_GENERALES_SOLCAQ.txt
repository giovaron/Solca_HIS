DECLARE
I NUMBER;
SUBGRUPO VARCHAR2(1000);
GRUPO VARCHAR2(1000);
CODIGO_PROPIO VARCHAR2(25);
CURSOR ACTIVOS IS
SELECT S.GRPACTFJO_EMP_CODIGO,           
       S.GRPACTFJO_CODIGO GRUPO,               
       S.CODIGO SUBGRUPO,
       M.DESCRIPCION,            
       M.FECHA_INGRESO,          
       M.VALOR_INICIAL,          
       M.VALOR_ACTUAL ,          
       M.MARCA        ,          
       M.MODELO       ,                    
       M.VIDA_UTIL    ,          
       M.PORCENTAJE_DEPRECIACION,
       M.OBSERVACIONES,
COUNT(*) CANTIDAD
FROM ACTIVOS_FIJOS_MAESTRO M,SUBGRUPOS_ACTIVOS_FIJOS S
WHERE M.DESCRIPCION = S.DESCRIPCION
GROUP BY S.GRPACTFJO_EMP_CODIGO,           
       S.GRPACTFJO_CODIGO,               
       S.CODIGO,
       M.DESCRIPCION,            
       M.FECHA_INGRESO,          
       M.VALOR_INICIAL,          
       M.VALOR_ACTUAL ,          
       M.MARCA        ,          
       M.MODELO       ,                    
       M.VIDA_UTIL      ,        
       M.PORCENTAJE_DEPRECIACION,
       M.OBSERVACIONES
ORDER BY S.GRPACTFJO_CODIGO,               
         S.CODIGO,
         M.DESCRIPCION;
BEGIN
SUBGRUPO:= NULL;
GRUPO:= NULL;
I:=1;
   FOR RACTIVOS IN ACTIVOS LOOP       
      IF SUBGRUPO = RACTIVOS.SUBGRUPO AND  GRUPO = RACTIVOS.GRUPO THEN
         CODIGO_PROPIO:=TO_CHAR(RACTIVOS.GRUPO,'FM0009')||'.'||TO_CHAR(RACTIVOS.SUBGRUPO,'FM0009')||'.'||TO_CHAR(I,'FM0009');
         INSERT INTO ACTIVOS_FIJOS_GENERALES(SBGACTFJO_GRPACTFJO_EMP_CODIGO,        
                SBGACTFJO_GRPACTFJO_CODIGO,SBGACTFJO_CODIGO,CODIGO,DESCRIPCION,                    
                FECHA_INGRESO,CANTIDAD_INICIAL,VALOR_INICIAL,VALOR_ACTUAL,TIPO,                           
                VIDA_UTIL,MODELO,MARCA,IVA,PORCENTAJE_DEPRECIACION,PORCENTAJE_REVALORIZACION,      
                ESTADO_DE_DISPONIBILIDAD,OBSERVACIONES,CODIGO_PROPIO)
         VALUES ('CSI',RACTIVOS.GRUPO,RACTIVOS.SUBGRUPO,I,RACTIVOS.DESCRIPCION,
                TO_DATE(RACTIVOS.FECHA_INGRESO,'DD/MM/RRRR'),TO_NUMBER(RACTIVOS.CANTIDAD),
                RACTIVOS.VALOR_INICIAL,RACTIVOS.VALOR_ACTUAL,'A',RACTIVOS.VIDA_UTIL,RACTIVOS.MODELO,
                RACTIVOS.MARCA,0.12,RACTIVOS.PORCENTAJE_DEPRECIACION,
                0,'D',RACTIVOS.OBSERVACIONES,CODIGO_PROPIO);
         I:=I+1;
         SUBGRUPO:= RACTIVOS.SUBGRUPO;
         GRUPO :=RACTIVOS.GRUPO;
      ELSE          
         I:=1;
         CODIGO_PROPIO:=TO_CHAR(RACTIVOS.GRUPO,'FM0009')||'.'||TO_CHAR(RACTIVOS.SUBGRUPO,'FM0009')||'.'||TO_CHAR(I,'FM0009');
         INSERT INTO ACTIVOS_FIJOS_GENERALES(SBGACTFJO_GRPACTFJO_EMP_CODIGO, 
                SBGACTFJO_GRPACTFJO_CODIGO,SBGACTFJO_CODIGO,CODIGO,DESCRIPCION,                    
                FECHA_INGRESO,CANTIDAD_INICIAL,VALOR_INICIAL,VALOR_ACTUAL,TIPO,                           
                VIDA_UTIL,MODELO,MARCA,IVA,PORCENTAJE_DEPRECIACION,PORCENTAJE_REVALORIZACION,      
                ESTADO_DE_DISPONIBILIDAD,OBSERVACIONES,CODIGO_PROPIO)
         VALUES ('CSI',RACTIVOS.GRUPO,RACTIVOS.SUBGRUPO,I,RACTIVOS.DESCRIPCION,
                TO_DATE(RACTIVOS.FECHA_INGRESO,'DD/MM/RRRR'),TO_NUMBER(RACTIVOS.CANTIDAD),
                RACTIVOS.VALOR_INICIAL,RACTIVOS.VALOR_ACTUAL,'A',RACTIVOS.VIDA_UTIL,RACTIVOS.MODELO,
                RACTIVOS.MARCA,0.12,RACTIVOS.PORCENTAJE_DEPRECIACION,
                0,'D',RACTIVOS.OBSERVACIONES,CODIGO_PROPIO);
         I:=I+1;
         SUBGRUPO:= RACTIVOS.SUBGRUPO;
         GRUPO :=RACTIVOS.GRUPO;
      END IF;
     END LOOP;     
END;
/
