CREATE OR REPLACE VIEW "SMS"."GASTOS_ROLES_DE_PAGOS" 
    ("EMP_CODIGO","TERCERIZADORA","AGRUPADOR_TIPO","MYR_CODIGO",
    "CNT_CODIGO","SCNT_CODIGO","AXL_CODIGO","SAXL_CODIGO",
    "SAXL2_CODIGO","SAXL3_CODIGO","PRMROL_NOMBRE","FECHA",
    "NUMERO","VALOR") AS 
    SELECT CNTASC.EMP_CODIGO, 
EMPROL.TERCERIZADORA TERCERIZADORA, 
EMPCNTCST.CNTCST_TIPO, 
PLNCNT.MYR_CODIGO, PLNCNT.CNT_CODIGO , 
PLNCNT.SCNT_CODIGO , PLNCNT.AXL_CODIGO , 
PLNCNT.SAXL_CODIGO , PLNCNT.SAXL2_CODIGO , 
PLNCNT.SAXL3_CODIGO , 
PRMROL.NOMBRE, 
MVMTOT.FECHA, 
MVMTOT.NUMERO, 
SUM(MVMTOT.DEBE*(EMPCNTCST.PORCENTAJE/100)) 
FROM MOVIMIENTOS_TOTALES MVMTOT, 
            CUENTAS_ASOCIADAS CNTASC, 
            EMPLEADOS_CENTROS_DE_COSTOS EMPCNTCST, 
            EMPLEADOS_ROLES EMPROL, 
            PLAN_DE_CUENTAS PLNCNT, 
            PARAMETROS_ROLES PRMROL 
WHERE MVMTOT.TIPO = 'ROL' AND 
               MVMTOT.PRMROL_EMP_CODIGO = PRMROL.EMP_CODIGO AND 
               MVMTOT.EMPROL_EMP_CODIGO = PRMROL.EMP_CODIGO AND 
               MVMTOT.PRMROL_CODIGO = PRMROL.CODIGO AND 
               MVMTOT.PRMROL_EMP_CODIGO = CNTASC.EMP_CODIGO AND 
               MVMTOT.PRMROL_CODIGO  = SUBSTR(CNTASC.CLAVE_RELACIONADA,1,5)  AND 
               MVMTOT.EMPROL_EMP_CODIGO = EMPCNTCST.EMPROL_EMP_CODIGO AND 
               MVMTOT.EMPROL_EMP_CODIGO = EMPCNTCST.CNTCST_EMP_CODIGO AND 
               MVMTOT.EMPROL_CODIGO = EMPCNTCST.EMPROL_CODIGO AND 
               MVMTOT.EMPROL_EMP_CODIGO = PLNCNT.EMP_CODIGO AND 
               MVMTOT.PRMROL_EMP_CODIGO = PLNCNT.EMP_CODIGO AND 
               MVMTOT.EMPROL_EMP_CODIGO = EMPROL.EMP_CODIGO AND 
               MVMTOT.EMPROL_CODIGO = EMPROL.CODIGO AND 
               CNTASC.TIPO_DE_CUENTA = 'RDP'  AND 
               CNTASC.TIPO_DE_ASOCIACION = 'GRP'  AND 
               CNTASC.EMP_CODIGO = EMPCNTCST.EMPROL_EMP_CODIGO AND 
               CNTASC.EMP_CODIGO = EMPCNTCST.CNTCST_EMP_CODIGO AND 
               CNTASC.AGRCNT_TIPO = EMPCNTCST.CNTCST_TIPO AND 
               CNTASC.AGRCNT_CODIGO = EMPCNTCST.CNTCST_AGRUPADOR AND 
               CNTASC.EMP_CODIGO = PLNCNT.EMP_CODIGO AND 
               CNTASC.CUENTA=PLNCNT.CODIGO AND 
               EMPCNTCST.EMPROL_EMP_CODIGO = PLNCNT.EMP_CODIGO AND 
               EMPCNTCST.CNTCST_EMP_CODIGO = PLNCNT.EMP_CODIGO AND 
               MVMTOT.DEBE > 0 AND 
               PRMROL.TIPO <> 'E' 
GROUP BY CNTASC.EMP_CODIGO, 
                     EMPROL.TERCERIZADORA,EMPCNTCST.CNTCST_TIPO, 
                     PLNCNT.MYR_CODIGO, PLNCNT.CNT_CODIGO , 
                     PLNCNT.SCNT_CODIGO , PLNCNT.AXL_CODIGO , 
                     PLNCNT.SAXL_CODIGO , PLNCNT.SAXL2_CODIGO , 
                     PLNCNT.SAXL3_CODIGO ,  PRMROL.NOMBRE, 
                     MVMTOT.FECHA,MVMTOT.NUMERO 
UNION 
SELECT CNTASC.EMP_CODIGO, 
EMPROL.TERCERIZADORA TERCERIZADORA,'0', 
PLNCNT.MYR_CODIGO, PLNCNT.CNT_CODIGO , 
PLNCNT.SCNT_CODIGO , PLNCNT.AXL_CODIGO , 
PLNCNT.SAXL_CODIGO , PLNCNT.SAXL2_CODIGO , 
PLNCNT.SAXL3_CODIGO , 
PRMROL.NOMBRE, 
MVMTOT.FECHA, 
MVMTOT.NUMERO, 
SUM(NVL(MVMTOT.DEBE,MVMTOT.HABER)) 
FROM MOVIMIENTOS_TOTALES MVMTOT, 
            PARAMETROS_ROLES PRMROL, 
            CUENTAS_ASOCIADAS CNTASC, 
            EMPLEADOS_CUENTAS_INDIVIDUALES EMPCNTIND, 
            EMPLEADOS_ROLES EMPROL, 
            PLAN_DE_CUENTAS PLNCNT 
WHERE PRMROL.TIPO_CONTABILIZACION = 'I' AND 
               MVMTOT.TIPO = 'ROL' AND 
               MVMTOT.PRMROL_EMP_CODIGO = PRMROL.EMP_CODIGO AND 
               MVMTOT.EMPROL_EMP_CODIGO = PRMROL.EMP_CODIGO AND 
               MVMTOT.PRMROL_CODIGO = PRMROL.CODIGO AND 
               MVMTOT.PRMROL_EMP_CODIGO = CNTASC.EMP_CODIGO AND 
               MVMTOT.PRMROL_CODIGO  =  SUBSTR(CNTASC.CLAVE_RELACIONADA,1,5)  AND 
               MVMTOT.EMPROL_EMP_CODIGO = PLNCNT.EMP_CODIGO AND 
               MVMTOT.PRMROL_EMP_CODIGO = PLNCNT.EMP_CODIGO AND 
               MVMTOT.EMPROL_EMP_CODIGO = EMPCNTIND.EMPROL_EMP_CODIGO AND 
               MVMTOT.EMPROL_CODIGO = EMPCNTIND.EMPROL_CODIGO AND 
               MVMTOT.EMPROL_EMP_CODIGO = EMPROL.EMP_CODIGO AND 
               MVMTOT.EMPROL_CODIGO = EMPROL.CODIGO AND 
               PRMROL.EMP_CODIGO = CNTASC.EMP_CODIGO AND 
               PRMROL.CODIGO  = CNTASC.CLAVE_RELACIONADA  AND 
               PRMROL.EMP_CODIGO = PLNCNT.EMP_CODIGO AND 
               CNTASC.TIPO_DE_CUENTA = 'RDP'  AND 
               CNTASC.TIPO_DE_ASOCIACION = 'GRP'  AND 
               CNTASC.EMP_CODIGO = PLNCNT.EMP_CODIGO AND 
               CNTASC.CUENTA=PLNCNT.CODIGO AND 
               CNTASC.EMP_CODIGO = EMPCNTIND.EMPROL_EMP_CODIGO AND 
               CNTASC.CUENTA = EMPCNTIND.CUENTA_CONTABLE AND 
               NVL( MVMTOT.DEBE,MVMTOT.HABER) > 0 AND 
               PRMROL.TIPO <> 'E' 
GROUP BY CNTASC.EMP_CODIGO,EMPROL.TERCERIZADORA,PLNCNT.MYR_CODIGO, PLNCNT.CNT_CODIGO , 
                     PLNCNT.SCNT_CODIGO , PLNCNT.AXL_CODIGO , 
                     PLNCNT.SAXL_CODIGO , PLNCNT.SAXL2_CODIGO , 
                    PLNCNT.SAXL3_CODIGO ,  PRMROL.NOMBRE, 
                    MVMTOT.FECHA , MVMTOT.NUMERO